
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
<script type="application/ld+json">
  {
    "@context": "https://schema.org/",
    "@type": "LearningResource",
    "@id": "https://sib-swiss.github.io/containers-introduction-training",
    "http://purl.org/dc/terms/conformsTo": {
        "@type": "CreativeWork",
        "@id": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE"
    },
    "description": "Course on containers for reproducible research",
    "keywords": "container, docker, singularity, reproducible",
    "name": " Docker and Singularity for reproducible research: getting started with containers ",

    "abstract": "Reproducible analysis in bioinformatics goes beyond good documentation and sharing code. Often, analyses depend on an entire environment with many different programs, libraries and settings. For the sake of reproducibility, but also for productivity, you might want to store, reuse, and share your environments using container software such as Docker and Singularity. Containerization is a lightweight and scalable way of working with such isolated environments. For example, with Docker you can develop, store and manage environments based on Linux operating systems which can run in mostly any computer. Often, bioinformatic calculations also require large memory and CPU resources, therefore you might want to use a shared computer environment (e.g. a HPC cluster). However, to run Docker you need to have privileged rights (i.e. as root), which is not the case for Singularity, a program that enables you to run environments from a wide range of resources (including Docker) in a safe manner without the need for privileged access. Combining Singularity and Docker thus makes you extremely flexible in how, when and where you use your computer environments and those of others. To introduce you to working with containers in the context of bioinformatics research, we will take a practical approach with several hands-on exercises to go through the basics of using, developing and sharing containers.",
    "audience": "Biologists, bioinformaticians and computational biologists",
    "author": [
        {
            "@type": "Person",
            "name": "Geert van Geest",
            "email": "geert.vangeest@sib.swiss"
        },
        {
            "@type": "Person",
            "name": "Patricia Palagi"
        },
        {
            "@type": "Organization",
            "name": "SIB Swiss Institute of Bioinformatics"
        }
    ],
    "identifier": "https://doi.org/10.5281/zenodo.6787081",
    "license": "https://creativecommons.org/licenses/by/4.0/",
    "teaches": [
        "Understand the basic concepts and terminology associated with virtualization with containers",
        "Be able to customize, store and share a containerized environment with Docker",
        "Understand the essential differences between Docker and Singularity",
        "Be able to use Singularity to run containers on a shared computer environment (e.g. a HPC cluster)"
    ]
}
</script>

    
      
        <title>Working with dockerfiles - Introduction to containers</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-1HJVS56CBX"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-1HJVS56CBX",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-1HJVS56CBX",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>

  
    <script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#learning-outcomes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
              <button class="md-banner__button md-icon" aria-label="Don't show this again">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
              </button>
            
            
  <b>Issues, questions or feedback? &#128591; &#128640; </b> Use the "Questions and Answers" section at the bottom &#128071; of every page

          </div>
          
            <script>var content,el=document.querySelector("[data-md-component=announce]");el&&(content=el.querySelector(".md-typeset"),__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0))</script>
          
        </aside>
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
  You're not viewing the latest version.
  <a href="../../.."> 
    <strong>Click here to go to latest.</strong>
  </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Introduction to containers" class="md-header__button md-logo" aria-label="Introduction to containers" data-md-component="logo">
      
  <img src="../../assets/images/SIB_logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Introduction to containers
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Working with dockerfiles
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/sib-swiss/containers-introduction-training" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    sib-swiss/containers-introduction-training
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Introduction to containers" class="md-nav__button md-logo" aria-label="Introduction to containers" data-md-component="logo">
      
  <img src="../../assets/images/SIB_logo.svg" alt="logo">

    </a>
    Introduction to containers
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/sib-swiss/containers-introduction-training" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    sib-swiss/containers-introduction-training
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../precourse/" class="md-nav__link">
        Precourse preparations
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../course_schedule/" class="md-nav__link">
        Course schedule
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Course material
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Course material" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Course material
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../introduction_containers/" class="md-nav__link">
        Introduction to containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../managing_docker/" class="md-nav__link">
        Managing containers and images
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Working with dockerfiles
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Working with dockerfiles
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-outcomes" class="md-nav__link">
    Learning outcomes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#material" class="md-nav__link">
    Material
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercises" class="md-nav__link">
    Exercises
  </a>
  
    <nav class="md-nav" aria-label="Exercises">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-dockerfile" class="md-nav__link">
    Basic Dockerfile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-cmd" class="md-nav__link">
    Using CMD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-an-image-for-your-own-script" class="md-nav__link">
    Build an image for your own script
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-information-on-your-image-with-docker-inspect" class="md-nav__link">
    Get information on your image with docker inspect
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-metadata-to-your-image" class="md-nav__link">
    Adding metadata to your image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-an-image-with-a-browser-interface" class="md-nav__link">
    Building an image with a browser interface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-information-on-your-image-with-docker-inspect_1" class="md-nav__link">
    Get information on your image with docker inspect
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-metadata-to-your-image_1" class="md-nav__link">
    Adding metadata to your image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-an-image-with-a-browser-interface_1" class="md-nav__link">
    Building an image with a browser interface
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../singularity/" class="md-nav__link">
        Running containers with singularity
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-outcomes" class="md-nav__link">
    Learning outcomes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#material" class="md-nav__link">
    Material
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercises" class="md-nav__link">
    Exercises
  </a>
  
    <nav class="md-nav" aria-label="Exercises">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-dockerfile" class="md-nav__link">
    Basic Dockerfile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-cmd" class="md-nav__link">
    Using CMD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-an-image-for-your-own-script" class="md-nav__link">
    Build an image for your own script
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-information-on-your-image-with-docker-inspect" class="md-nav__link">
    Get information on your image with docker inspect
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-metadata-to-your-image" class="md-nav__link">
    Adding metadata to your image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-an-image-with-a-browser-interface" class="md-nav__link">
    Building an image with a browser interface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-information-on-your-image-with-docker-inspect_1" class="md-nav__link">
    Get information on your image with docker inspect
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-metadata-to-your-image_1" class="md-nav__link">
    Adding metadata to your image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-an-image-with-a-browser-interface_1" class="md-nav__link">
    Building an image with a browser interface
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
  
                  

  <a href="https://github.com/sib-swiss/containers-introduction-training/edit/main/docs/course_material/dockerfiles.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


  <h1>Working with dockerfiles</h1>

<h2 id="learning-outcomes">Learning outcomes</h2>
<p><strong>After having completed this chapter you will be able to:</strong></p>
<ul>
<li>Build an image based on a dockerfile</li>
<li>Use the basic dockerfile syntax</li>
<li>Change the default command of an image and validate the change</li>
<li>Map ports to a container to display interactive content through a browser</li>
</ul>
<h2 id="material">Material</h2>
<ul>
<li><a href="https://docs.docker.com/engine/reference/builder/">Official <code>Dockerfile</code> reference</a></li>
<li><a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1008316">Ten simple rules for writing dockerfiles</a></li>
</ul>
<h2 id="exercises">Exercises</h2>
<p>To make your images shareable and adjustable, it&rsquo;s good practice to work with a <code>Dockerfile</code>. This is a script with a set of instructions to build your image from an existing image.</p>
<h3 id="basic-dockerfile">Basic <code>Dockerfile</code></h3>
<p>You can generate an image from a <code>Dockerfile</code> using the command <code>docker build</code>. A <code>Dockerfile</code> has its own syntax for giving instructions. Luckily, they are rather simple. The script always contains a line starting with <code>FROM</code> that takes the image name from which the new image will be built. After that you usually want to run some commands to e.g. configure and/or install software. The instruction to run these commands during building starts with <code>RUN</code>.  In our <code>figlet</code> example that would be:</p>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">ubuntu:jammy-20230308</span>
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>figlet
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">On writing reproducible <code>Dockerfiles</code></p>
<p>At the <code>FROM</code> statement in the the above <code>Dockerfile</code> you see that we have added a specific tag to the image (i.e. <code>jammy-20230308</code>). We could also have written:</p>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">ubuntu</span>
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>figlet
</code></pre></div>
<p>This will automatically pull the image with the tag <code>latest</code>. However, if the maintainer of the <code>ubuntu</code> images decides to tag another <code>ubuntu</code> version as <code>latest</code>, rebuilding with the above <code>Dockerfile</code> will not give you the same result. Therefore it&rsquo;s always good practice to add the (stable) tag to the image in a <code>Dockerfile</code>. More rules on making your <code>Dockerfiles</code> more reproducible <a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1008316">here</a>.</p>
</div>
<p><strong>Exercise:</strong> Create a file on your computer called <code>Dockerfile</code>, and paste the above instruction lines in that file. Make the directory containing the <code>Dockerfile</code> your current directory. Build a new image based on that <code>Dockerfile</code> with:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">x86_64 / AMD64</label><label for="__tabbed_1_2">ARM64 (MacOS M1 chip)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>build<span class="w"> </span>.
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>build<span class="w"> </span>--platform<span class="w"> </span>amd64<span class="w"> </span>.
</code></pre></div>
</div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">If using an Apple M1 chip (newer Macs)</p>
<p>If you are using a computer with an Apple M1 chip, you have the less common ARM system architecture, which can limit transferability of images to (more common) <code>x86_64/AMD64</code> machines. When building images on a Mac with an M1 chip (especially if you have sharing in mind), it&rsquo;s best to specify the <code>--platform amd64</code> flag. </p>
</div>
<div class="admonition note">
<p class="admonition-title">The argument of <code>docker build</code></p>
<p>The command <code>docker build</code> takes a directory as input (providing <code>.</code> means the current directory). This directory should contain the <code>Dockerfile</code>, but it can also contain more of the build context, e.g. (python, R, shell) scripts that are required to build the image.</p>
</div>
<p>What has happened? What is the name of the build image?</p>
<details class="done">
<summary>Answer</summary>
<p>A new image was created based on the <code>Dockerfile</code>. You can check it with: <code>docker image ls</code>, which gives something like:</p>
<div class="highlight"><pre><span></span><code>REPOSITORY                        TAG       IMAGE ID       CREATED             SIZE
&lt;none&gt;                            &lt;none&gt;    92c980b09aad   7 seconds ago       101MB
ubuntu-figlet                     latest    e08b999c7978   About an hour ago   101MB
ubuntu                            latest    f63181f19b2f   30 hours ago        72.9MB
</code></pre></div>
<p>It has created an image without a name or tag. That&rsquo;s a bit inconvenient.</p>
</details>
<p><strong>Exercise:</strong> Build a new image with a specific name. You can do that with adding the option <code>-t</code> to <code>docker build</code>. Before that, remove the nameless image.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>An image without a name is usually a &ldquo;dangling image&rdquo;. You can remove those with <code>docker image prune</code>.</p>
</div>
<details class="done">
<summary>Answer</summary>
<p>Remove the nameless image with <code>docker image prune</code>.</p>
<p>After that, rebuild an image with a name:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">x86_64 / AMD64</label><label for="__tabbed_2_2">ARM (MacOS M1 chip)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>ubuntu-figlet:v2<span class="w"> </span>.
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>build<span class="w"> </span>--platform<span class="w"> </span>amd64<span class="w"> </span>-t<span class="w"> </span>ubuntu-figlet:v2<span class="w"> </span>.
</code></pre></div>
</div>
</div>
</div>
</details>
<h3 id="using-cmd">Using <code>CMD</code></h3>
<p>As you might remember the second positional argument of <code>docker run</code> is a command (i.e. <code>docker run IMAGE [CMD]</code>). If you leave it empty, it uses the default command. You can change the default command in the <code>Dockerfile</code> with an instruction starting with <code>CMD</code>. For example:</p>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">ubuntu:jammy-20230308</span>
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>figlet
<span class="k">CMD</span><span class="w"> </span>figlet<span class="w"> </span>My<span class="w"> </span>image<span class="w"> </span>works!
</code></pre></div>
<p><strong>Exercise:</strong> Build a new image based on the above <code>Dockerfile</code>. Can you validate the change using <code>docker image inspect</code>? Can you overwrite this default with <code>docker run</code>?</p>
<details class="done">
<summary>Answer</summary>
<p>Copy the new line to your <code>Dockerfile</code>, and build the new image like this:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">x86_64 / AMD64</label><label for="__tabbed_3_2">ARM64 (MacOS M1 chip)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>ubuntu-figlet:v3<span class="w"> </span>.
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>build<span class="w"> </span>--platform<span class="w"> </span>amd64<span class="w"> </span>-t<span class="w"> </span>ubuntu-figlet:v3<span class="w"> </span>.
</code></pre></div>
</div>
</div>
</div>
<p>The command <code>docker inspect ubuntu-figlet:v3</code> will give:</p>
<div class="highlight"><pre><span></span><code>&quot;Cmd&quot;: [
    &quot;/bin/sh&quot;,
    &quot;-c&quot;,
    &quot;figlet My image works!&quot;
]
</code></pre></div>
<p>So the default command (<code>/bin/bash</code>) has changed to <code>figlet My image works!</code></p>
<p>Running the image (with clean-up (<code>--rm</code>)):</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>ubuntu-figlet:v3
</code></pre></div>
<p>Will result in:</p>
<div class="highlight"><pre><span></span><code>__  __         _                                                 _        _
|  \/  |_   _  (_)_ __ ___   __ _  __ _  ___  __      _____  _ __| | _____| |
| |\/| | | | | | | &#39;_ ` _ \ / _` |/ _` |/ _ \ \ \ /\ / / _ \| &#39;__| |/ / __| |
| |  | | |_| | | | | | | | | (_| | (_| |  __/  \ V  V / (_) | |  |   &lt;\__ \_|
|_|  |_|\__, | |_|_| |_| |_|\__,_|\__, |\___|   \_/\_/ \___/|_|  |_|\_\___(_)
       |___/                     |___/
</code></pre></div>
<p>And of course you can overwrite the default command:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>ubuntu-figlet:v3<span class="w"> </span>figlet<span class="w"> </span>another<span class="w"> </span>text
</code></pre></div>
<p>Resulting in:</p>
<div class="highlight"><pre><span></span><code>_   _                 _            _
__ _ _ __   ___ | |_| |__   ___ _ __  | |_ _____  _| |_
/ _` | &#39;_ \ / _ \| __| &#39;_ \ / _ \ &#39;__| | __/ _ \ \/ / __|
| (_| | | | | (_) | |_| | | |  __/ |    | ||  __/&gt;  &lt;| |_
\__,_|_| |_|\___/ \__|_| |_|\___|_|     \__\___/_/\_\\__|
</code></pre></div>
</details>
<div class="admonition note">
<p class="admonition-title">Two flavours of <code>CMD</code></p>
<p>You have seen in the output of <code>docker inspect</code> that docker translates the command (i.e. <code>figlet "my image works!"</code>) into this: <code>["/bin/sh", "-c", "figlet 'My image works!'"]</code>. The notation we used in the <code>Dockerfile</code> is the <em>shell notation</em> while the notation with the square brackets (<code>[]</code>) is the <em>exec-notation</em>. You can use both notations in your <code>Dockerfile</code>. Altough the <em>shell notation</em> is more readable, the <em>exec notation</em> is directly used by the image, and therefore less ambiguous.</p>
<p>A <code>Dockerfile</code> with shell notation:</p>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">ubuntu:jammy-20230308</span>
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>figlet
<span class="k">CMD</span><span class="w"> </span>figlet<span class="w"> </span>My<span class="w"> </span>image<span class="w"> </span>works!
</code></pre></div>
<p>A <code>Dockerfile</code> with exec notation:</p>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">ubuntu:jammy-20230308</span>
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>figlet
<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/bin/sh&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-c&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;figlet My image works!&quot;</span><span class="p">]</span>
</code></pre></div>
</div>
<p><strong>Exercise:</strong> Now push our created image (with a version tag) to docker hub. We will use it later for the <a href="../singularity/"><code>singularity</code> exercises</a>.</p>
<details class="done">
<summary>Answer</summary>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>tag<span class="w"> </span>ubuntu-figlet:v3<span class="w"> </span><span class="o">[</span>USER<span class="w"> </span>NAME<span class="o">]</span>/ubuntu-figlet:v3
docker<span class="w"> </span>push<span class="w"> </span><span class="o">[</span>USER<span class="w"> </span>NAME<span class="o">]</span>/ubuntu-figlet:v3
</code></pre></div>
</details>
<h3 id="build-an-image-for-your-own-script">Build an image for your own script</h3>
<p>Often containers are built for a specific purpose. For example, you can use a container to ship all dependencies together with your developed set of scripts/programs. For that you will need to add your scripts to the container. That is quite easily done with the instruction <code>COPY</code>. However, in order to make your container more user-friendly, there are several additional instructions that can come in useful. We will treat the most frequently used ones below. Depending on your preference, either choose <strong>R</strong> or <strong>Python</strong> below. </p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">R</label><label for="__tabbed_4_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>In the exercises will use a simple script called <code>search_biomart_datasets.R</code>. You can download it <a href="https://raw.githubusercontent.com/sib-swiss/containers-introduction-training/main/docker/exercise_r_script/search_biomart_datasets.R">here</a>, or copy-paste it:</p>
<div class="highlight"><span class="filename">search_biomart_datasets.R</span><pre><span></span><code><span class="c1">#!/usr/bin/env Rscript</span>

<span class="nf">library</span><span class="p">(</span><span class="n">biomaRt</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">optparse</span><span class="p">)</span>

<span class="n">option_list</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span>
<span class="w">    </span><span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;--pattern&quot;</span><span class="p">),</span>
<span class="w">        </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;character&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">help</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Search pattern [default = %default]&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;mouse&quot;</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">)</span>

<span class="n">opt_parser</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">OptionParser</span><span class="p">(</span>
<span class="w">    </span><span class="n">option_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">option_list</span><span class="p">,</span>
<span class="w">    </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Searches biomaRt ensembl datasets&quot;</span>
<span class="p">)</span>
<span class="n">opt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">parse_args</span><span class="p">(</span><span class="n">opt_parser</span><span class="p">)</span>

<span class="n">ensembl</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">useEnsembl</span><span class="p">(</span><span class="n">biomart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ensembl&quot;</span><span class="p">)</span>
<span class="nf">searchDatasets</span><span class="p">(</span><span class="n">mart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ensembl</span><span class="p">,</span><span class="w"> </span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">opt</span><span class="o">$</span><span class="n">pattern</span><span class="p">)</span>
</code></pre></div>
<p>After you have downloaded it, make sure to set the permissions to executable:</p>
<p><div class="highlight"><pre><span></span><code>chmod<span class="w"> </span>+x<span class="w"> </span>search_biomart_datasets.R
</code></pre></div>
It is a relatively simple script that searches for datasets in ensembl with <code>biomaRt</code> based on a pattern that is specified by the user. An example for execution would be:</p>
<div class="highlight"><pre><span></span><code>./search_biomart_datasets.R<span class="w"> </span>--pattern<span class="w"> </span><span class="s2">&quot;mouse&quot;</span>
</code></pre></div>
<p>Returning a list with all mouse datasets:</p>
<div class="highlight"><pre><span></span><code>                        dataset                                      description
94      mcaroli_gene_ensembl             Ryukyu mouse genes (CAROLI_EIJ_v1.1)
109     mpahari_gene_ensembl              Shrew mouse genes (PAHARI_EIJ_v1.1)
111 mspicilegus_gene_ensembl                     Steppe mouse genes (MUSP714)
112    mspretus_gene_ensembl              Algerian mouse genes (SPRET_EiJ_v1)
149   pmbairdii_gene_ensembl Northern American deer mouse genes (HU_Pman_2.1)
            version
94  CAROLI_EIJ_v1.1
109 PAHARI_EIJ_v1.1
111         MUSP714
112    SPRET_EiJ_v1
149     HU_Pman_2.1
</code></pre></div>
<p>From the script you can see it has two dependencies: <code>biomaRt</code> and <code>optparse</code>. If we want to run it inside a container, we would have to install these. We do this in the <code>Dockerfile</code> below. We give the the following instructions:</p>
<ul>
<li>use the <a href="https://hub.docker.com/_/r-base">R base container</a> version 4.2.3</li>
<li>install the package <code>optparse</code> from CRAN (<code>r-cran-optparse</code>) and <code>biomaRt</code> from Bioconductor (<code>r-bioc-biomart</code>) with <code>apt-get</code>. </li>
<li>copy the script <code>search_biomart_datasets.R</code> to <code>/opt</code> inside the container:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">r-base:4.2.3</span>

<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>r-cran-optparse<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>r-bioc-biomart

<span class="k">COPY</span><span class="w"> </span>search_biomart_datasets.R<span class="w"> </span>/opt<span class="w"> </span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In order to use <code>COPY</code>, the file that needs to be copied needs to be in the same directory as the <code>Dockerfile</code> or one of its subdirectories.</p>
</div>
<div class="admonition note">
<p class="admonition-title">R image stack</p>
<p>The most used R image stack is from the <a href="https://rocker-project.org/">rocker project</a>. It contains many different base images (e.g. with shiny, Rstudio, tidyverse etc.). It depends on the type of image whether installations with <code>apt-get</code> is possible. To understand more about how to install R packages in different containers, check it this <a href="https://raw.githubusercontent.com/sib-swiss/containers-introduction-training/main/r-docker-cheatsheet/r-docker-cheatsheet.pdf">cheat sheet</a>, or visit <a href="https://rocker-project.org/">rocker-project.org</a>.</p>
</div>
<p><strong>Exercise:</strong> Download the <code>search_biomart_datasets.R</code> and build the image with <code>docker build</code>. After that, execute the script inside the container. </p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Make an interactive session with the options <code>-i</code> and <code>-t</code> and use <code>/bin/bash</code> as the command. </p>
</div>
<details class="done">
<summary>Answer</summary>
<p>Build the container:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:2"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><input id="__tabbed_5_2" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">x86_64 / AMD64</label><label for="__tabbed_5_2">ARM64 (MacOS M1 chip)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>search_biomart_datasets<span class="w"> </span>.
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>build<span class="w"> </span>--platform<span class="w"> </span>amd64<span class="w"> </span>-t<span class="w"> </span>search_biomart_datasets<span class="w"> </span>.
</code></pre></div>
</div>
</div>
</div>
<p>Run the container:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--rm<span class="w"> </span>search_biomart_datasets<span class="w"> </span>/bin/bash
</code></pre></div>
<p>Inside the container we look up the script:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/opt
ls
</code></pre></div>
<p>This should return <code>search_biomart_datasets.R</code>. </p>
<p>Now you can execute it from inside the container:</p>
<div class="highlight"><pre><span></span><code>./search_biomart_datasets.R<span class="w"> </span>--pattern<span class="w"> </span>sapiens
</code></pre></div>
</details>
<p>That&rsquo;s kind of nice. We can ship our R script inside our container. However, we don&rsquo;t want to run it interactively every time. So let&rsquo;s make some changes to make it easy to run it as an executable. For example, we can add <code>/opt</code> to the global <code>$PATH</code> variable with <code>ENV</code>. </p>
<div class="admonition note">
<p class="admonition-title">The <code>$PATH</code> variable</p>
<p>The path variable is a special variable that consists of a list of path seperated by colons (<code>:</code>). These paths are searched if you are trying to run an executable. More info this topic at e.g. <a href="https://en.wikipedia.org/wiki/PATH_(variable)">wikipedia</a>. </p>
</div>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">r-base:4.2.3</span>

<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>r-cran-optparse<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>r-bioc-biomart

<span class="k">COPY</span><span class="w"> </span>search_biomart_datasets.R<span class="w"> </span>/opt<span class="w"> </span>

<span class="k">ENV</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/opt:<span class="nv">$PATH</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>ENV</code> instruction can be used to set any variable. </p>
</div>
<p><strong>Exercise</strong>: Rebuild the image and start an interactive bash session inside the new image. Is the path variable updated? (i.e. can we execute <code>search_biomart_datasets.R</code> from anywhere?)</p>
<details class="done">
<summary>Answer</summary>
<p>After re-building we start an interactive session:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--rm<span class="w"> </span>search_biomart_datasets<span class="w"> </span>/bin/bash
</code></pre></div>
<p>The path is upated, <code>/opt</code> is appended to the beginning of the variable:</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="nv">$PATH</span>
</code></pre></div>
<p>returns:</p>
<div class="highlight"><pre><span></span><code>/opt:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
</code></pre></div>
<p>Now you can try to execute it from the root directory (or any other):</p>
<div class="highlight"><pre><span></span><code>search_biomart_datasets.R<span class="w"> </span>--pattern<span class="w"> </span><span class="s2">&quot;(C|c)ow&quot;</span>
</code></pre></div>
</details>
<p>Instead of starting an interactive session with <code>/bin/bash</code> we can now more easily run the script non-interactively:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>search_biomart_datasets<span class="w"> </span>search_biomart_datasets.R<span class="w"> </span>--pattern<span class="w"> </span><span class="s2">&quot;(R|r)at&quot;</span>
</code></pre></div>
<p>Now it will directly print the output of <code>search_biomart_datasets.R</code> to stdout. </p>
<p>In the case you want to pack your script inside a container, you are building a container specifically for your script, meaning you almost want the container to behave as the program itself. In order to do that, you can use <code>ENTRYPOINT</code>. <code>ENTRYPOINT</code> is similar to <code>CMD</code>, but has two important differences:</p>
<ul>
<li><code>ENTRYPOINT</code> can not be overwritten by the positional arguments (i.e. <code>docker run image [CMD]</code>), but has to be overwritten by <code>--entrypoint</code>. </li>
<li>The positional arguments (or <code>CMD</code>) are pasted to the <code>ENTRYPOINT</code> command. This means that you can use <code>ENTRYPOINT</code> as the executable and the positional arguments (or <code>CMD</code>) as the options. </li>
</ul>
<p>Let&rsquo;s try it out:</p>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">r-base:4.2.3</span>

<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>r-cran-optparse<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>r-bioc-biomart

<span class="k">COPY</span><span class="w"> </span>search_biomart_datasets.R<span class="w"> </span>/opt<span class="w"> </span>

<span class="k">ENV</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/opt:<span class="nv">$PATH</span>

<span class="c"># note that if you want to be able to combine the two</span>
<span class="c"># both ENTRYPOINT and CMD need to written in the exec form</span>
<span class="k">ENTRYPOINT</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;search_biomart_datasets.R&quot;</span><span class="p">]</span>

<span class="c"># default option (if positional arguments are not specified)</span>
<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;--pattern&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;mouse&quot;</span><span class="p">]</span>
</code></pre></div>
<p><strong>Exercise</strong>: Re-build, and run the container non-interactively without any positional arguments. After that, try to pass a different pattern to <code>--pattern</code>. How do the commands look?</p>
<details class="done">
<summary>Answer</summary>
<p>Just running the container non-interactively would be:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>search_biomart_datasets
</code></pre></div>
<p>Passing a different argument (i.e. overwriting <code>CMD</code>) would be:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>search_biomart_datasets.R<span class="w"> </span>--pattern<span class="w"> </span><span class="s2">&quot;sapiens&quot;</span>
</code></pre></div>
<p>Here, the container behaves as the executable itself to which you can pass arguments. </p>
</details>
<p>Most containerized applications need multiple build steps. Often, you want to perform these steps and executions in a specific directory. Therefore, it can be in convenient to specify a working directory. You can do that with <code>WORKDIR</code>. This instruction will set the default directory for all other instructions (like <code>RUN</code>, <code>COPY</code> etc.). It will also change the directory in which you will land if you run the container interactively.</p>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">r-base:4.2.3</span>

<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>r-cran-optparse<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>r-bioc-biomart

<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/opt</span>

<span class="k">COPY</span><span class="w"> </span>search_biomart_datasets.R<span class="w"> </span>.

<span class="k">ENV</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/opt:<span class="nv">$PATH</span>

<span class="c"># note that if you want to be able to combine the two</span>
<span class="c"># both ENTRYPOINT and CMD need to written in the exec form</span>
<span class="k">ENTRYPOINT</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;search_biomart_datasets.R&quot;</span><span class="p">]</span>

<span class="c"># default option (if positional arguments are not specified)</span>
<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;--pattern&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;mouse&quot;</span><span class="p">]</span>
</code></pre></div>
<p><strong>Exercise</strong>: build the image, and start the container interactively. Has the default directory changed? After that, push the image to dockerhub, so we can use it later with the singularity exercises.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can overwrite <code>ENTRYPOINT</code> with <code>--entrypoint</code> as an argument to <code>docker run</code>. </p>
</div>
<details class="done">
<summary>Answer</summary>
<p>Running the container interactively would be:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--rm<span class="w"> </span>--entrypoint<span class="w"> </span>/bin/bash<span class="w"> </span>search_biomart_datasets
</code></pre></div>
<p>Which should result in a terminal looking something like this:</p>
<div class="highlight"><pre><span></span><code>root@9a27da455fb1:/opt#
</code></pre></div>
<p>Meaning that indeed the default directory has changed to <code>/opt</code></p>
<p>Pushing it to dockerhub: </p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>tag<span class="w"> </span>search_biomart_datasets<span class="w"> </span><span class="o">[</span>USER<span class="w"> </span>NAME<span class="o">]</span>/search_biomart_datasets:v1
docker<span class="w"> </span>push<span class="w"> </span><span class="o">[</span>USER<span class="w"> </span>NAME<span class="o">]</span>/search_biomart_datasets:v1
</code></pre></div>
</details>
<h3 id="get-information-on-your-image-with-docker-inspect">Get information on your image with <code>docker inspect</code></h3>
<p>We have used <code>docker inspect</code> already in the previous chapter to find the default <code>Cmd</code> of the ubuntu image. However we can get more info on the image: e.g. the entrypoint, environmental variables, cmd, workingdir etc., you can use the <code>Config</code> record from the output of <code>docker inspect</code>. For our image this looks like:</p>
<div class="highlight"><pre><span></span><code><span class="s">&quot;Config&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
<span class="w">        </span><span class="s">&quot;Hostname&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;Domainname&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;User&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;AttachStdin&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;AttachStdout&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;AttachStderr&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;Tty&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;OpenStdin&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;StdinOnce&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;Env&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
<span class="w">            </span><span class="s">&quot;PATH=/opt:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><span class="p p-Indicator">,</span>
<span class="w">            </span><span class="s">&quot;LC_ALL=en_US.UTF-8&quot;</span><span class="p p-Indicator">,</span>
<span class="w">            </span><span class="s">&quot;LANG=en_US.UTF-8&quot;</span><span class="p p-Indicator">,</span>
<span class="w">            </span><span class="s">&quot;R_BASE_VERSION=4.2.3&quot;</span>
<span class="w">        </span><span class="p p-Indicator">],</span>
<span class="w">        </span><span class="s">&quot;Cmd&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
<span class="w">            </span><span class="s">&quot;--pattern&quot;</span><span class="p p-Indicator">,</span>
<span class="w">            </span><span class="s">&quot;mouse&quot;</span>
<span class="w">        </span><span class="p p-Indicator">],</span>
<span class="w">        </span><span class="s">&quot;ArgsEscaped&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">true</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;Image&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;Volumes&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">null</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;WorkingDir&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;/opt&quot;</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;Entrypoint&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
<span class="w">            </span><span class="s">&quot;search_biomart_datasets.R&quot;</span>
<span class="w">        </span><span class="p p-Indicator">],</span>
<span class="w">        </span><span class="s">&quot;OnBuild&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">null</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;Labels&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
<span class="w">            </span><span class="s">&quot;org.opencontainers.image.authors&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Dirk</span><span class="nv"> </span><span class="s">Eddelbuettel</span><span class="nv"> </span><span class="s">&lt;edd@debian.org&gt;&quot;</span><span class="p p-Indicator">,</span>
<span class="w">            </span><span class="s">&quot;org.opencontainers.image.licenses&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;GPL-2.0-or-later&quot;</span><span class="p p-Indicator">,</span>
<span class="w">            </span><span class="s">&quot;org.opencontainers.image.source&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;https://github.com/rocker-org/rocker&quot;</span><span class="p p-Indicator">,</span>
<span class="w">            </span><span class="s">&quot;org.opencontainers.image.vendor&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Rocker</span><span class="nv"> </span><span class="s">Project&quot;</span>
<span class="w">        </span><span class="p p-Indicator">}</span>
<span class="w">    </span><span class="p p-Indicator">}</span>
</code></pre></div>
<h3 id="adding-metadata-to-your-image">Adding metadata to your image</h3>
<p>You can annotate your <code>Dockerfile</code> and the image by using the instruction <code>LABEL</code>. You can give it any key and value with <code>&lt;key&gt;=&lt;value&gt;</code>. However, it is recommended to use the <a href="https://github.com/opencontainers/image-spec/blob/v1.0.1/annotations.md">Open Container Initiative (OCI) keys</a>.</p>
<p><strong>Exercise</strong>: Annotate our <code>Dockerfile</code> with the OCI keys on the creation date, author and description. After that, check whether this has been passed to the actual image with <code>docker inspect</code>. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can type <code>LABEL</code> for each key-value pair, but you can also have it on one line by seperating the key-value pairs by a space, e.g.:</p>
<div class="highlight"><pre><span></span><code><span class="k">LABEL</span><span class="w"> </span><span class="nv">keyx</span><span class="o">=</span><span class="s2">&quot;valuex&quot;</span><span class="w"> </span><span class="nv">keyy</span><span class="o">=</span><span class="s2">&quot;valuey&quot;</span>
</code></pre></div>
</div>
<details class="done">
<summary>Answer</summary>
<p>The <code>Dockerfile</code> would look like:</p>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">r-base:4.2.3</span>

<span class="k">LABEL</span><span class="w"> </span>org.opencontainers.image.created<span class="o">=</span><span class="s2">&quot;2023-04-12&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>org.opencontainers.image.authors<span class="o">=</span><span class="s2">&quot;Geert van Geest&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>org.opencontainers.image.description<span class="o">=</span><span class="s2">&quot;Container to search ensembl datasets with biomart&quot;</span>

<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>r-cran-optparse<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>r-bioc-biomart

<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/opt</span>

<span class="k">COPY</span><span class="w"> </span>search_biomart_datasets.R<span class="w"> </span>.

<span class="k">ENV</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/opt:<span class="nv">$PATH</span>

<span class="c"># note that if you want to be able to combine the two</span>
<span class="c"># both ENTRYPOINT and CMD need to written in the exec form</span>
<span class="k">ENTRYPOINT</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;search_biomart_datasets.R&quot;</span><span class="p">]</span>

<span class="c"># default option (if positional arguments are not specified)</span>
<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;--pattern&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;mouse&quot;</span><span class="p">]</span>
</code></pre></div>
<p>The <code>Config</code> record in the output of <code>docker inspect</code> was updated with:</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span><span class="s">&quot;Labels&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
<span class="w">        </span><span class="s">&quot;org.opencontainers.image.authors&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Geert</span><span class="nv"> </span><span class="s">van</span><span class="nv"> </span><span class="s">Geest&quot;</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;org.opencontainers.image.created&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;2023-04-12&quot;</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;org.opencontainers.image.description&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Container</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">search</span><span class="nv"> </span><span class="s">ensembl</span><span class="nv"> </span><span class="s">datasets</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">biomart&quot;</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;org.opencontainers.image.licenses&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;GPL-2.0-or-later&quot;</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;org.opencontainers.image.source&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;https://github.com/rocker-org/rocker&quot;</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;org.opencontainers.image.vendor&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Rocker</span><span class="nv"> </span><span class="s">Project&quot;</span>
<span class="w">    </span><span class="p p-Indicator">}</span>
</code></pre></div>
</details>
<h3 id="building-an-image-with-a-browser-interface">Building an image with a browser interface</h3>
<p>In this exercise, we will use a different base image (<code>rocker/rstudio:4</code>), and we&rsquo;ll install the same packages. <a href="https://posit.co/download/rstudio-server/">Rstudio server</a> is a nice browser interface that you can use for a.o. programming in R. With the image we are creating we will be able to run Rstudio server inside a container.  Check out the <code>Dockerfile</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">rocker/rstudio:4</span>

<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>libz-dev

<span class="k">RUN</span><span class="w"> </span>install2.r<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>optparse<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>BiocManager

<span class="k">RUN</span><span class="w"> </span>R<span class="w"> </span>-q<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;BiocManager::install(&quot;biomaRt&quot;)&#39;</span>
</code></pre></div>
<p>This will create an image from the existing <code>rstudio</code> image. It will also install <code>libz-dev</code> with <code>apt-get</code>, <code>BiocManager</code> with <code>install2.r</code> and <code>biomaRt</code> with an R command. Despiste we&rsquo;re installing the same packages, the installation steps need to be different from the <code>r-base</code> image. This is because in the <code>rocker/rstudio</code> images R is installed from source, and therefore you can&rsquo;t install packages with <code>apt-get</code>. More information on how to install R packages in R containers in this <a href="https://raw.githubusercontent.com/sib-swiss/containers-introduction-training/main/r-docker-cheatsheet/r-docker-cheatsheet.pdf">cheat sheet</a>, or visit <a href="https://rocker-project.org/">rocker-project.org</a>.</p>
<p><strong>Exercise:</strong> Build an image based on this <code>Dockerfile</code> and give it a meaningful name.</p>
<details class="done">
<summary>Answer</summary>
<div class="tabbed-set tabbed-alternate" data-tabs="6:2"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><input id="__tabbed_6_2" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">x86_64 / AMD64</label><label for="__tabbed_6_2">ARM64 (MacOS M1 chip)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>rstudio-server<span class="w"> </span>.
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>build<span class="w"> </span>--platform<span class="w"> </span>amd64<span class="w"> </span>-t<span class="w"> </span>rstudio-server<span class="w"> </span>.
</code></pre></div>
</div>
</div>
</div>
</details>
<p>You can now run a container from the image. However, you will have to tell docker where to publish port 8787 from the docker container with <code>-p [HOSTPORT:CONTAINERPORT]</code>. We choose to publish it to the same port number:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-it<span class="w"> </span>-p<span class="w"> </span><span class="m">8787</span>:8787<span class="w"> </span>rstudio-server
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Networking</p>
<p>More info on docker container networking <a href="https://docs.docker.com/config/containers/container-networking/">here</a></p>
</div>
<p>By running the above command, a container will be started exposing rstudio server at port 8787 at localhost. You can approach the instance of jupyterhub by typing <code>localhost:8787</code> in your browser. You will be asked for a password. You can find this password in the terminal from which you have started the container.</p>
<p>We can make this even more interesting by mounting a local directory to the container running the jupyter-lab image:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span><span class="se">\</span>
-it<span class="w"> </span><span class="se">\</span>
--rm<span class="w"> </span><span class="se">\</span>
-p<span class="w"> </span><span class="m">8787</span>:8787<span class="w"> </span><span class="se">\</span>
--mount<span class="w"> </span><span class="nv">type</span><span class="o">=</span>bind,source<span class="o">=</span>/Users/myusername/working_dir,target<span class="o">=</span>/home/rstudio/working_dir<span class="w"> </span><span class="se">\</span>
rstudio-server
</code></pre></div>
<p>By doing this you have a completely isolated and shareable R environment running Rstudio server, but with your local files available to it. Pretty neat right? </p>
</div>
<div class="tabbed-block">
<p>In the exercises will use a simple script called <code>daterange.py</code>. You can download it <a href="https://raw.githubusercontent.com/sib-swiss/containers-introduction-training/main/docker/exercise_python_script/daterange.py">here</a>. Or copy-paste it from here:</p>
<div class="highlight"><span class="filename">daterange.py</span><pre><span></span><code><span class="ch">#!/usr/bin/env python3</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Get a daterange&quot;</span><span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-d&#39;</span><span class="p">,</span> <span class="s1">&#39;--date&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Date. Format: [YYYYMMDD]&#39;</span><span class="p">)</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</code></pre></div>
<p>After you have downloaded it, make sure to set the permissions to executable:</p>
<div class="highlight"><pre><span></span><code>chmod<span class="w"> </span>+x<span class="w"> </span>daterange.py
</code></pre></div>
<p>Have a look at <code>daterange.py</code>. It is a simple script that uses <code>pandas</code> and <code>argparse</code>. It takes a date (in the format <code>YYYYMMDD</code>) as provided by the option <code>--date</code>, and returns a list of all dates in the week starting from that date. An example for execution would be:</p>
<div class="highlight"><pre><span></span><code>./daterange.py<span class="w"> </span>--date<span class="w"> </span><span class="m">20220226</span>
</code></pre></div>
<p>Giving a list of dates starting from 26-FEB-2022:</p>
<div class="highlight"><pre><span></span><code>2022-02-26 00:00:00
2022-02-27 00:00:00
2022-02-28 00:00:00
2022-03-01 00:00:00
2022-03-02 00:00:00
2022-03-03 00:00:00
2022-03-04 00:00:00
</code></pre></div>
<p>From the script, you can see it has the dependecy <code>pandas</code>, which is not a <a href="https://docs.python.org/3/py-modindex.html">built-in module</a>. In the <code>Dockerfile</code> below we give the instruction to install <code>pandas</code> with <code>pip</code> and copy <code>daterange.py</code> to <code>/opt</code> inside the container:</p>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">python:3.9.16</span>

<span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>pandas<span class="w"> </span>

<span class="k">COPY</span><span class="w"> </span>daterange.py<span class="w"> </span>/opt<span class="w"> </span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In order to use <code>COPY</code>, the file that needs to be copied needs to be in the same directory as the <code>Dockerfile</code> or one of its subdirectories.</p>
</div>
<p><strong>Exercise:</strong> Download the <code>daterange.py</code> and build the image with <code>docker build</code>. After that, execute the script inside the container. </p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Make an interactive session with the options <code>-i</code> and <code>-t</code> and use <code>/bin/bash</code> as the command. </p>
</div>
<details class="done">
<summary>Answer</summary>
<p>Build the container:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:2"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><input id="__tabbed_7_2" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">x86_64 / AMD64</label><label for="__tabbed_7_2">ARM64 (MacOS M1 chip)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>daterange<span class="w"> </span>.
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>build<span class="w"> </span>--platform<span class="w"> </span>amd64<span class="w"> </span>-t<span class="w"> </span>daterange<span class="w"> </span>.
</code></pre></div>
</div>
</div>
</div>
<p>Run the container:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--rm<span class="w"> </span>daterange<span class="w"> </span>/bin/bash
</code></pre></div>
<p>Inside the container we look up the script:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/opt
ls
</code></pre></div>
<p>This should return <code>daterange.py</code>. </p>
<p>Now you can execute it from inside the container:</p>
<div class="highlight"><pre><span></span><code>./daterange.py<span class="w"> </span>--date<span class="w"> </span><span class="m">20220226</span>
</code></pre></div>
</details>
<p>That&rsquo;s kind of nice. We can ship our python script inside our container. However, we don&rsquo;t want to run it interactively every time. So let&rsquo;s make some changes to make it easy to run it as an executable. For example, we can add <code>/opt</code> to the global <code>$PATH</code> variable with <code>ENV</code>. </p>
<div class="admonition note">
<p class="admonition-title">The <code>$PATH</code> variable</p>
<p>The path variable is a special variable that consists of a list of path seperated by colons (<code>:</code>). These paths are searched if you are trying to run an executable. More info this topic at e.g. <a href="https://en.wikipedia.org/wiki/PATH_(variable)">wikipedia</a>. </p>
</div>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">python:3.9.16</span>

<span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>pandas<span class="w"> </span>

<span class="k">COPY</span><span class="w"> </span>daterange.py<span class="w"> </span>/opt<span class="w"> </span>

<span class="k">ENV</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/opt:<span class="nv">$PATH</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>ENV</code> instruction can be used to set any variable. </p>
</div>
<p><strong>Exercise</strong>: Start an interactive bash session inside the new container. Is the path variable updated? (i.e. can we execute <code>daterange.py</code> from anywhere?)</p>
<details class="done">
<summary>Answer</summary>
<p>After re-building we start an interactive session:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--rm<span class="w"> </span>daterange<span class="w"> </span>/bin/bash
</code></pre></div>
<p>The path is upated, <code>/opt</code> is appended to the beginning of the variable:</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="nv">$PATH</span>
</code></pre></div>
<p>returns:</p>
<div class="highlight"><pre><span></span><code>/opt:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
</code></pre></div>
<p>Now you can try to execute it from the root directory (or any other):</p>
<div class="highlight"><pre><span></span><code>daterange.py<span class="w"> </span>--date<span class="w"> </span><span class="m">20220226</span>
</code></pre></div>
</details>
<p>Instead of starting an interactive session with <code>/bin/bash</code> we can now more easily run the script non-interactively:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>daterange<span class="w"> </span>daterange.py<span class="w"> </span>--date<span class="w"> </span><span class="m">20220226</span>
</code></pre></div>
<p>Now it will directly print the output of <code>daterange.py</code> to stdout. </p>
<p>In the case you want to pack your script inside a container, you are building a container specifically for your script, meaning you almost want the container to behave as the program itself. In order to do that, you can use <code>ENTRYPOINT</code>. <code>ENTRYPOINT</code> is similar to <code>CMD</code>, but has two important differences:</p>
<ul>
<li><code>ENTRYPOINT</code> can not be overwritten by the positional arguments (i.e. <code>docker run image [CMD]</code>), but has to be overwritten by <code>--entrypoint</code>. </li>
<li>The positional arguments (or <code>CMD</code>) are pasted to the <code>ENTRYPOINT</code> command. This means that you can use <code>ENTRYPOINT</code> as the executable and the positional arguments (or <code>CMD</code>) as the options. </li>
</ul>
<p>Let&rsquo;s try it out:</p>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">python:3.9.16</span>

<span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>pandas<span class="w"> </span>

<span class="k">COPY</span><span class="w"> </span>daterange.py<span class="w"> </span>/opt<span class="w"> </span>

<span class="k">ENV</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/opt:<span class="nv">$PATH</span>

<span class="c"># note that if you want to be able to combine the two</span>
<span class="c"># both ENTRYPOINT and CMD need to written in the exec form</span>
<span class="k">ENTRYPOINT</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;daterange.py&quot;</span><span class="p">]</span>

<span class="c"># default option (if positional arguments are not specified)</span>
<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;--date&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;20220226&quot;</span><span class="p">]</span>
</code></pre></div>
<p><strong>Exercise</strong>: Re-build, and run the container non-interactively without any positional arguments. After that, try to pass a different date to <code>--date</code>. How do the commands look?</p>
<details class="done">
<summary>Answer</summary>
<p>Just running the container non-interactively would be:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>daterange
</code></pre></div>
<p>Passing a different argument (i.e. overwriting <code>CMD</code>) would be:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>daterange<span class="w"> </span>--date<span class="w"> </span><span class="m">20210330</span>
</code></pre></div>
<p>Here, the container behaves as the executable itself to which you can pass arguments. </p>
</details>
<p>Most containerized applications need multiple build steps. Often, you want to perform these steps and executions in a specific directory. Therefore, it can be in convenient to specify a working directory. You can do that with <code>WORKDIR</code>. This instruction will set the default directory for all other instructions (like <code>RUN</code>, <code>COPY</code> etc.). It will also change the directory in which you will land if you run the container interactively.</p>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">python:3.9.16</span>

<span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>pandas<span class="w"> </span>

<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/opt</span>

<span class="c"># we don&#39;t have to specify /opt as target dir but the current dir</span>
<span class="k">COPY</span><span class="w"> </span>daterange.py<span class="w"> </span>.

<span class="k">ENV</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/opt:<span class="nv">$PATH</span>

<span class="c"># note that if you want to be able to combine the two</span>
<span class="c"># both ENTRYPOINT and CMD need to written in the exec form</span>
<span class="k">ENTRYPOINT</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;daterange.py&quot;</span><span class="p">]</span>

<span class="c"># default option (if positional arguments are not specified)</span>
<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;--date&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;20220226&quot;</span><span class="p">]</span>
</code></pre></div>
<p><strong>Exercise</strong>: build the image, and start the container interactively. Has the default directory changed? After that, push the image to dockerhub, so we can use it later with the singularity exercises.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can overwrite <code>ENTRYPOINT</code> with <code>--entrypoint</code> as an argument to <code>docker run</code>. </p>
</div>
<details class="done">
<summary>Answer</summary>
<p>Running the container interactively would be:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--rm<span class="w"> </span>--entrypoint<span class="w"> </span>/bin/bash<span class="w"> </span>daterange
</code></pre></div>
<p>Which should result in a terminal looking something like this:</p>
<div class="highlight"><pre><span></span><code>root@9a27da455fb1:/opt#
</code></pre></div>
<p>Meaning that indeed the default directory has changed to <code>/opt</code></p>
<p>Pushing it to dockerhub: </p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>tag<span class="w"> </span>daterage<span class="w"> </span><span class="o">[</span>USER<span class="w"> </span>NAME<span class="o">]</span>/daterange:v1
docker<span class="w"> </span>push<span class="w"> </span><span class="o">[</span>USER<span class="w"> </span>NAME<span class="o">]</span>/daterange:v1
</code></pre></div>
</details>
<h3 id="get-information-on-your-image-with-docker-inspect_1">Get information on your image with <code>docker inspect</code></h3>
<p>We have used <code>docker inspect</code> already in the previous chapter to find the default <code>Cmd</code> of the ubuntu image. However we can get more info on the image: e.g. the entrypoint, environmental variables, cmd, workingdir etc., you can use the <code>Config</code> record from the output of <code>docker inspect</code>. For our image this looks like:</p>
<div class="highlight"><pre><span></span><code><span class="s">&quot;Config&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
<span class="w">        </span><span class="s">&quot;Hostname&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;Domainname&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;User&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;AttachStdin&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;AttachStdout&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;AttachStderr&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;Tty&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;OpenStdin&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;StdinOnce&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;Env&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
<span class="w">            </span><span class="s">&quot;PATH=/opt:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><span class="p p-Indicator">,</span>
<span class="w">            </span><span class="s">&quot;LANG=C.UTF-8&quot;</span><span class="p p-Indicator">,</span>
<span class="w">            </span><span class="s">&quot;GPG_KEY=E3FF2839C048B25C084DEBE9B26995E310250568&quot;</span><span class="p p-Indicator">,</span>
<span class="w">            </span><span class="s">&quot;PYTHON_VERSION=3.9.4&quot;</span><span class="p p-Indicator">,</span>
<span class="w">            </span><span class="s">&quot;PYTHON_PIP_VERSION=21.1.1&quot;</span><span class="p p-Indicator">,</span>
<span class="w">            </span><span class="s">&quot;PYTHON_GET_PIP_URL=https://github.com/pypa/get-pip/raw/1954f15b3f102ace496a34a013ea76b061535bd2/public/get-pip.py&quot;</span><span class="p p-Indicator">,</span>
<span class="w">            </span><span class="s">&quot;PYTHON_GET_PIP_SHA256=f499d76e0149a673fb8246d88e116db589afbd291739bd84f2cd9a7bca7b6993&quot;</span>
<span class="w">        </span><span class="p p-Indicator">],</span>
<span class="w">        </span><span class="s">&quot;Cmd&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
<span class="w">            </span><span class="s">&quot;--date&quot;</span><span class="p p-Indicator">,</span>
<span class="w">            </span><span class="s">&quot;20220226&quot;</span>
<span class="w">        </span><span class="p p-Indicator">],</span>
<span class="w">        </span><span class="s">&quot;ArgsEscaped&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">true</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;Image&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;Volumes&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">null</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;WorkingDir&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;/opt&quot;</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;Entrypoint&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
<span class="w">            </span><span class="s">&quot;daterange.py&quot;</span>
<span class="w">        </span><span class="p p-Indicator">],</span>
<span class="w">        </span><span class="s">&quot;OnBuild&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">null</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;Labels&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">null</span>
<span class="w">    </span><span class="p p-Indicator">}</span><span class="err">,</span>
</code></pre></div>
<h3 id="adding-metadata-to-your-image_1">Adding metadata to your image</h3>
<p>You can annotate your <code>Dockerfile</code> and the image by using the instruction <code>LABEL</code>. You can give it any key and value with <code>&lt;key&gt;=&lt;value&gt;</code>. However, it is recommended to use the <a href="https://github.com/opencontainers/image-spec/blob/v1.0.1/annotations.md">Open Container Initiative (OCI) keys</a>.</p>
<p><strong>Exercise</strong>: Annotate our <code>Dockerfile</code> with the OCI keys on the creation date, author and description. After that, check whether this has been passed to the actual image with <code>docker inspect</code>. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can type <code>LABEL</code> for each key-value pair, but you can also have it on one line by seperating the key-value pairs by a space, e.g.:</p>
<div class="highlight"><pre><span></span><code><span class="k">LABEL</span><span class="w"> </span><span class="nv">keyx</span><span class="o">=</span><span class="s2">&quot;valuex&quot;</span><span class="w"> </span><span class="nv">keyy</span><span class="o">=</span><span class="s2">&quot;valuey&quot;</span>
</code></pre></div>
</div>
<details class="done">
<summary>Answer</summary>
<p>The <code>Dockerfile</code> would look like:</p>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">python:3.9.16</span>

<span class="k">LABEL</span><span class="w"> </span>org.opencontainers.image.created<span class="o">=</span><span class="s2">&quot;2022-04-12&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>org.opencontainers.image.authors<span class="o">=</span><span class="s2">&quot;Geert van Geest&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>org.opencontainers.image.description<span class="o">=</span><span class="s2">&quot;Great container for getting all dates in a week! \</span>
<span class="s2">    You will never use a calender again&quot;</span>

<span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>pandas<span class="w"> </span>

<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/opt</span>

<span class="k">COPY</span><span class="w"> </span>daterange.py<span class="w"> </span>.

<span class="k">ENV</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/opt:<span class="nv">$PATH</span>

<span class="c"># note that if you want to be able to combine the two</span>
<span class="c"># both ENTRYPOINT and CMD need to written in the exec form</span>
<span class="k">ENTRYPOINT</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;daterange.py&quot;</span><span class="p">]</span>

<span class="c"># default option (if positional arguments are not specified)</span>
<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;--date&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;20220226&quot;</span><span class="p">]</span>
</code></pre></div>
<p>The <code>Config</code> record in the output of <code>docker inspect</code> was updated with:</p>
<div class="highlight"><pre><span></span><code><span class="s">&quot;Labels&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
<span class="w">            </span><span class="s">&quot;org.opencontainers.image.authors&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Geert</span><span class="nv"> </span><span class="s">van</span><span class="nv"> </span><span class="s">Geest&quot;</span><span class="p p-Indicator">,</span>
<span class="w">            </span><span class="s">&quot;org.opencontainers.image.created&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;2022-04-12&quot;</span><span class="p p-Indicator">,</span>
<span class="w">            </span><span class="s">&quot;org.opencontainers.image.description&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Great</span><span class="nv"> </span><span class="s">container</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">getting</span><span class="nv"> </span><span class="s">all</span><span class="nv"> </span><span class="s">dates</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">week!</span><span class="nv">     </span><span class="s">You</span><span class="nv"> </span><span class="s">will</span><span class="nv"> </span><span class="s">never</span><span class="nv"> </span><span class="s">use</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">calender</span><span class="nv"> </span><span class="s">again&quot;</span>
<span class="w">        </span><span class="p p-Indicator">}</span>
</code></pre></div>
</details>
<h3 id="building-an-image-with-a-browser-interface_1">Building an image with a browser interface</h3>
<p>In this exercise, we will use a different base image from the <a href="https://jupyter-docker-stacks.readthedocs.io/en/latest/using/common.html">jupyter docker image stack</a>. <a href="https://jupyter.org/">JupyterLab</a> is a nice browser interface that you can use for a.o. programming in python. With the image we are creating we will be able to run jupyter lab inside a container.  Check out the <code>Dockerfile</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">jupyter/base-notebook:python-3.9</span>

<span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>pandas
</code></pre></div>
<p>This will create an image from the existing <code>python</code> image. It will also install <code>jupyterlab</code> with <code>pip</code>. As a default command it starts a jupyter notebook at port 8888.</p>
<div class="admonition note">
<p class="admonition-title">Ports</p>
<p>We have specified here that jupyter lab should use port 8888. However, this <strong>inside</strong> the container. We can not connect to it yet with our browser.</p>
</div>
<p><strong>Exercise:</strong> Build an image based on this <code>Dockerfile</code> and give it a meaningful name.</p>
<details class="done">
<summary>Answer</summary>
<div class="tabbed-set tabbed-alternate" data-tabs="8:2"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><input id="__tabbed_8_2" name="__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="__tabbed_8_1">x86_64 / AMD64</label><label for="__tabbed_8_2">ARM64 (MacOS M1 chip)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>jupyter-lab<span class="w"> </span>.
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>build<span class="w"> </span>--platform<span class="w"> </span>amd64<span class="w"> </span>-t<span class="w"> </span>jupyter-lab<span class="w"> </span>.
</code></pre></div>
</div>
</div>
</div>
</details>
<p>You can now run a container from the image. However, you will have to tell docker where to publish port 8888 from the docker container with <code>-p [HOSTPORT:CONTAINERPORT]</code>. We choose to publish it to the same port number:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-it<span class="w"> </span>-p<span class="w"> </span><span class="m">8888</span>:8888<span class="w"> </span>jupyter-lab
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Networking</p>
<p>More info on docker container networking <a href="https://docs.docker.com/config/containers/container-networking/">here</a></p>
</div>
<p>By running the above command, a container will be started exposing jupyterhub at port 8888 at localhost. You can approach the instance of jupyterhub by typing <code>localhost:8888</code> in your browser. You will be asked for a token. You can find this token in the terminal from which you have started the container.</p>
<p>We can make this even more interesting by mounting a local directory to the container running the jupyter-lab image:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span><span class="se">\</span>
-it<span class="w"> </span><span class="se">\</span>
--rm<span class="w"> </span><span class="se">\</span>
-p<span class="w"> </span><span class="m">8888</span>:8888<span class="w"> </span><span class="se">\</span>
--mount<span class="w"> </span><span class="nv">type</span><span class="o">=</span>bind,source<span class="o">=</span>/Users/myusername/working_dir,target<span class="o">=</span>/working_dir/<span class="w"> </span><span class="se">\</span>
jupyter-lab
</code></pre></div>
<p>By doing this you have a completely isolated and shareable python environment running jupyter lab, but with your local files available to it. Pretty neat right? </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Jupyter has a wide range of pre-built images available <a href="https://jupyter-docker-stacks.readthedocs.io/en/latest/using/common.html">here</a>.</p>
</div>
</div>
</div>
</div>


  




                

  <!-- Giscus -->
  <h2>Questions & Answers</h2>

    <script src="https://giscus.app/client.js"
            data-repo="sib-swiss/containers-introduction-training"
            data-repo-id="MDEwOlJlcG9zaXRvcnkzMzE4OTA0MzA="
            data-category="Q&A"
            data-category-id="DIC_kwDOE8g-_s4CSEuU"
            data-mapping="pathname"
            data-strict="0"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-input-position="top"
            data-theme="preferred_color_scheme"
            data-lang="en"
            crossorigin="anonymous"
            async>
    </script>
  <!-- Synchronize Giscus theme with palette -->
  <script>
    var giscus = document.querySelector("script[src*=giscus]")

    /* Set palette on initial load */
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
      var theme = palette.color.scheme === "slate" ? "dark" : "light"
      giscus.setAttribute("data-theme", theme) 


    }

    /* Register event handlers after documented loaded */
    document.addEventListener("DOMContentLoaded", function() {
      var ref = document.querySelector("[data-md-component=palette]")
      ref.addEventListener("change", function() {
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
          var theme = palette.color.scheme === "slate" ? "dark" : "light"

          /* Instruct Giscus to change theme */
          var frame = document.querySelector(".giscus-frame")
          frame.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app"
          )
        }
      })
    })
  </script>

              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../managing_docker/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Managing containers and images" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Managing containers and images
            </div>
          </div>
        </a>
      
      
        
        <a href="../singularity/" class="md-footer__link md-footer__link--next" aria-label="Next: Running containers with singularity" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Running containers with singularity
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2021-2022 SIB Swiss institute of Bioinformatics  <a href="#__consent">Change cookie settings</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  


  
    
  



  

<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input type="checkbox" class="md-toggle" id="__settings">
<div class="md-consent__settings">
  <ul class="task-list">
    
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        <label>
      </li>
    
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="github" checked>
          <span class="task-list-indicator"></span>
          GitHub
        <label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);console.log(new FormData(form)),__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["announce.dismiss"], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.8492ddcf.min.js"></script>
      
    
  </body>
</html>